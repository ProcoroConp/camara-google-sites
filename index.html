<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Foto Surreal</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: Arial, sans-serif;
  text-align: center;
}

.screen {
  display: none;
  height: 100vh;
  padding: 20px;
}

.screen.active {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.logo-intro {
  max-width: 220px;
  height: auto;
  margin-bottom: 30px;
}

button {
  background: #c4007a;
  color: #000;
  border: none;
  padding: 12px 20px;
  font-size: 16px;
  margin: 8px;
  cursor: pointer;
}

#camera-container {
  position: relative;
  width: 100%;
}

video {
  width: 100%;
  max-height: 70vh;
}

.overlay-logo {
  position: absolute;
  bottom: 12px;
  width: 100%;
  display: flex;
  justify-content: center;
}

.overlay-logo img {
  max-width: 140px;
  height: auto;
}

canvas {
  max-width: 100%;
}
</style>
</head>

<body>

<!-- PANTALLA 1 -->
<div id="intro" class="screen active">
  <img src="logo.png" class="logo-intro">
  <h1>Tómate una foto surreal</h1>
  <p>Colócate frente a la cámara<br>y guarda tu momento</p>
  <button onclick="startCamera()">Activar cámara</button>
</div>

<!-- PANTALLA 2 -->
<div id="camera" class="screen">
  <div id="camera-container">
    <video id="video" autoplay playsinline></video>

    <div class="overlay-logo">
      <img src="logo.png" id="logoOverlay">
    </div>
  </div>

  <div>
    <button onclick="takePhoto()">Tomar foto</button>
    <button onclick="switchCamera()">Cambiar cámara</button>
  </div>
</div>

<!-- PANTALLA 3 -->
<div id="result" class="screen">
  <canvas id="canvas"></canvas>
  <div>
    <a id="download" download="foto-desafio-dali.png">
      <button>Descargar</button>
    </a>
    <button onclick="resetAll()">Repetir</button>
  </div>
</div>

<script>
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let stream;
let useFront = false;

function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startCamera() {
  showScreen("camera");
  openCamera();
}

function openCamera() {
  if (stream) stream.getTracks().forEach(t => t.stop());

  navigator.mediaDevices.getUserMedia({
    video: { facingMode: useFront ? "user" : "environment" },
    audio: false
  }).then(s => {
    stream = s;
    video.srcObject = s;
  });
}

function switchCamera() {
  useFront = !useFront;
  openCamera();
}

function takePhoto() {
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;

  ctx.drawImage(video, 0, 0);

  let logo = new Image();
  logo.src = "logo.png";
  logo.onload = () => {
    let logoWidth = canvas.width * 0.25;
    let ratio = logo.height / logo.width;
    let logoHeight = logoWidth * ratio;

    ctx.drawImage(
      logo,
      canvas.width / 2 - logoWidth / 2,
      canvas.height - logoHeight - 20,
      logoWidth,
      logoHeight
    );

    document.getElementById("download").href = canvas.toDataURL("image/png");
    showScreen("result");
  };
}

function resetAll() {
  showScreen("intro");
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Momento Surreal – Desafío Dalí</title>

<style>
body {
  font-family: Oswald, sans-serif;
  text-align: center;
  padding: 15px;
}

.barra {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 10px;
}

.barra img {
  height: 40px;
}

video, canvas {
  width: 100%;
  max-width: 360px;
  border-radius: 14px;
  margin-top: 10px;
}

.controls {
  text-align: left;
  max-width: 360px;
  margin: 15px auto;
}

.controls label {
  display: block;
  margin-bottom: 6px;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  background: #c4007a;
  color: #00;
  border-radius: 8px;
  border: none;
  font-size: 16px;
}
</style>
</head>

<body>

<!-- Barra fija -->
<div class="barra">
  <img src="logo.png">
  <strong>Desafío Dalí</strong>
</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<button onclick="abrirCamara()">Abrir cámara</button>
<button onclick="tomarFoto()">Tomar foto</button>

<!-- Selector de frases -->
<div class="controls">
  <strong>Elige la frase</strong>

  <label><input type="radio" name="fraseBase" value="frase1" checked> Momento surreal en Desafío Dalí</label>
  <label><input type="radio" name="fraseBase" value="frase2"> Vive el genio del surrealismo</label>
  <label><input type="radio" name="fraseBase" value="frase3"> Una experiencia fuera de la realidad</label>

  <br>
  <strong>Elige el color</strong>

  <label><input type="radio" name="color" value="a" checked> Color A</label>
  <label><input type="radio" name="color" value="b"> Color B</label>

  <label><input type="radio" name="fraseBase" value=""> Sin texto</label>
</div>

<button onclick="renderFinal()">Ver preview</button>
<button onclick="descargarCompartir()">Descargar / Compartir</button>

<script>
let video = document.getElementById("video");
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let fotoBase = null;

function abrirCamara() {
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => video.srcObject = stream);
}

function tomarFoto() {
  canvas.style.display = "block";
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video, 0, 0);
  fotoBase = ctx.getImageData(0, 0, canvas.width, canvas.height);
}

function renderFinal() {
  if (!fotoBase) return;

  ctx.putImageData(fotoBase, 0, 0);

  // Logo
  const logo = new Image();
  logo.src = "logo.png";
  logo.onload = () => {
    let lw = canvas.width * 0.22;
    let lh = logo.height * (lw / logo.width);
    ctx.drawImage(logo, canvas.width - lw - 15, canvas.height - lh - 15, lw, lh);

    // Frase imagen
    let fraseBase = document.querySelector('input[name="fraseBase"]:checked').value;
    let color = document.querySelector('input[name="color"]:checked').value;

    if (fraseBase) {
      let frase = new Image();
      frase.src = `${fraseBase}_${color}.png`;
      frase.onload = () => {
        let fw = canvas.width * 0.7;
        let fh = frase.height * (fw / frase.width);
        ctx.drawImage(frase, (canvas.width - fw) / 2, canvas.height - fh - 30, fw, fh);
      };
    }
  };
}

function descargarCompartir() {
  canvas.toBlob(blob => {
    let file = new File([blob], "momento-dali.png", { type: "image/png" });

    if (navigator.share) {
      navigator.share({
        files: [file],
        title: "Momento surreal",
        text: "Viví Desafío Dalí"
      });
    } else {
      let a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "momento-dali.png";
      a.click();
    }
  });
}
</script>

</body>
</html>

